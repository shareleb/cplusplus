rpc定义：
    远程调用，用于解决分布式系统中网络通信问题，对网络通信进行完整封装 及强大治理功能 （连接管理、健康检测、负载均衡、优雅启停机、异常重试、业务分组以及熔断限流）
rpc过程：
 协议
 序列化  PB
 网络通信  IO多路复用 + 非阻塞 + 多线程。
 动态代理
网络通信过程：
    对段断点查找，网络通信建立，传输，管理。 编码解码/

常用框架有：
    Thrift, Mrpc, Grpc.
常用序列化
    Json, PB, thrift.  PB 跨平台，序列化后体积小，解析快，兼容性好。


RPC 一般采用TCP传输协议， 需要采用序列化协议让对象转换为二进制。

RPC框架：
    服务发现 ， 负载均衡， 失败重试， 连接管理， 限流熔断， 链路追踪, 路由管理。


服务发现 ：
    服务注册：在服务提供方启动的时候，将对外暴露的接口注册到注册中心之中，注册中心将这个服务节点的IP和接口保存下来。
    服务订阅：在服务调用方启动的时候，去注册中心查找并订阅服务提供方的IP，然后缓存到本地，并用于后续的远程调用。
    可以使用zk,etcd
        缺点： 
            当连接到ZooKeeper的节点数量特别多，对ZooKeeper读写特别频繁，且ZooKeeper存储的目录达到一定数量的时候，ZooKeeper将不再稳定，CPU持续升高，最终宕机。而宕机之后，由于各业务的节点还在持续发送读写请求，刚一启动，ZooKeeper就因无法承受瞬间的读写压力，马上宕机

 健康检查：
    为了保证请求成功，我们就需要确保每次选择出来的IP对应的连接是健康的。终极的解决方案是让调用方实时感知到节点的状态变化，
    心跳机制：
        心跳机制说起来也不复杂，其实就是服务调用方每隔一段时间就问一下服务提供方，“兄弟，你还好吧？”，然后服务提供方很诚实地告诉调用方它目前的状态。
        健康状态：建立连接成功，并且心跳探活也一直成功；
        亚健康状态：建立连接成功，但是心跳请求连续失败； 
        死亡状态：建立连接失败。    

        当服务调用方通过心跳机制了解了节点的状态之后，每次发请求的时候，就可以优先从健康列表里面选择一个节点。当然，如果健康列表为空，为了提高可用性，也可以尝试从亚健康列表里面选择一个，这就是具体的策略了。 可以用可用率的计算方式是某一个时间窗口内接口调用成功次数的百分比（成功次数/总调用次数）。
        它能帮助我们从连接列表里面过滤掉一些存在问题的节点，避免在发请求的时候选择出有问题的节点而影响业务

路由策略：
    请求按照我们设定的规则发送到目标节点上，从而实现流量隔离的效果。
    通过服务发现的方式来隔离调用方请求，从逻辑上来看确实可行，但注册中心在RPC里面的定位是用来存储数据并保证数据一致性的。如果把这种复杂的计算逻辑放到注册中心里面，当集群节点变多之后，就会导致注册中心压力很大，而且大部分情况下我们一般都是采用开源软件来搭建注册中心，要满足这种需求还需要进行二次开发。

    过滤策略， ip路由， 参数路由。

    灰度发布功能是RPC路由功能的一个典型应用场景，通过RPC路由策略的组合使用可以让服务提供方更加灵活地管理、调用自己的流量，进一步降低上线可能导致的风险。
负载均衡：
     rr 随机 lalb

异常重试：
    这个机制是当调用端发起的请求失败时，如果配置了异常重试策略，RPC框架会捕捉异常，对异常进行判定，符合条件则进行重试，重新发送请求。

    在重试的过程中，为了能够在约定的时间内进行安全可靠地重试，在每次触发重试之前，我们需要先判定下这个请求是否已经超时，如果超时了会直接返回超时异常，否则我们需要重置下这个请求的超时时间，防止因多次重试导致这个请求的处理时间超过用户配置的超时时间，从而影响到业务处理的耗时。

    在发起重试、负载均衡选择节点的时候，我们应该去掉重试之前出现过问题的那个节点，这样可以提高重试的成功率，并且我们允许用户配置可重试异常的白名单，这样可以让RPC框架的异常重试功能变得更加友好。

    另外，在使用RPC框架的重试机制时，我们要确保被调用的服务的业务逻辑是幂等的，这样才能考虑是否使用重试，这一点至关重要。

优雅关闭：
    调用方发请求前，目标服务已经下线。对于调用方来说，跟目标节点的连接会断开，这时候调用方可以立马感知到，并且在其健康列表里面会把这个节点挪掉，自然也就不会被负载均衡选中。
调用方发请求的时候，目标服务正在关闭，但调用方并不知道它正在关闭，而且两者之间的连接也没断开，所以这个节点还会存在健康列表里面，因此该节点就有一定概率会被负载均衡选中。